# 简单的操作系统实现

## 环境

Ubuntu 18.04/16.04

QEMU 模拟器

as 汇编器

## 编程规范

1. 开始编程前请确保已经与远程库同步, 编写, 测试之后及时同步到远程库
2. 除了 `Makefile` 外, 全部使用空格控制缩进 (即软tab)
3. 汇编代码使用 8 个空格缩进, C代码使用 4 个空格缩进

## 文件列表

- `bootsect.S` 启动区, 编译后被放在软盘的第一个扇区 (512 字节)
- `ld_script.ld` 链接脚本, 用于去掉 elf 文件头
- `setup.S` 初始化程序, 编译后被放在软盘的第二到第五扇区

## `bootsect.S` 启动区

1. 启动时, 被加载到 `[0x07c00, 0x07e00)`
2. 把 `setup.S` 加载到 `[0x80000, 0x80800)`
3. 跳转到 `setup.S` 进行操作系统的初始化

## `setup.S` 操作系统初始化程序

1. 把 C0-H0-S6 ~ C19-H1-S18 这 715 个扇区的内容加载到 `[0x10000, 0x69600)` 的位置. 这也是目前限定的操作系统的大小 (357kb应该足够使用)
2. 打开 A20 地址线
3. 切换图形模式 `VGA 0x12 640x480x16`
4. 把操作系统移动到 `[0x00000, 0x59600)`
5. 设置 GDT, GDTR 的值为 `0x59700|0x0f00`
5. 进入保护模式
6. 跳转到 `0x0000` 继续执行

## `system`

生成 `system` 就是操作系统, 会被加载到 `0x0000`.

目前 `system` 由 `sys_head.S` 和 `os_main.c` 拼接而成

### `sys_head.S` 操作系统头

操作系统最开始的一段代码, 目前仅仅用于跳转到 `os_main.c` 中的 `main()` 函数.

之后可以扩展, 添加一些函数, 或者执行一些初始化 (IDT, PIC等).

### `os_main.c` 

`main()` 函数, C 语言的起点

## 备注

1. 目前从软盘启动, 改成从硬盘驱动, 需要修改 bootsect.S 和 setup.S 中的 INT 0x13 调用的参数
2. 打印字符串的一些调用可以风格统一/优化
3. 目前不太清楚 BIOS 中设置的显示模式和进入操作系统之后设置的显示模式有什么关系, 当然, 我们的操作系统不会涉及这一点